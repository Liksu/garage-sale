<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prepare photo links</title>
    <style>
        body {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            flex-wrap: nowrap;
        }

        img {
            width: 100px;
            height: 100px;
            object-fit: contain;
        }

        tr {
            cursor: pointer;
        }
    </style>
</head>
<body>
<table id="all-photos">
    <tr>
        <td>Loading...</td>
    </tr>
</table>
<div>
    <button onclick="copyToCB(this)">Copy Links</button>
    <table id="selected">
        <tbody></tbody>
    </table>
</div>
</body>
<script type="module">
    window.photos = await fetch('/api/photos').then(res => res.json())
    document.querySelector('#all-photos').innerHTML = photos.items
        .sort((a, b) => a.title.localeCompare(b.title))
        .map(item => `
            <tr onclick="check(this)" id="photo-${item.id}">
                <td><input type="checkbox" value="${item.id}"></td>
                <td><img src="${item.thumbnailLink}" alt=""></td>
                <td>${item.title}</td>
            </tr>
        `).join('')
</script>
<script>
    function check(row) {
        const checkbox = row.querySelector('input[type="checkbox"]')
        checkbox.checked = !checkbox.checked

        const selected = document.querySelector('#selected tbody')

        if (checkbox.checked) {
            const id = checkbox.value
            const photo = window.photos.items.find(item => item.id === id)
            selected.innerHTML += `
                <tr id="photo-${id}" data-id="${id}">
                    <td>
                        <button onclick="up(this)">&uparrow;</button>
                        <button onclick="down(this)">&downarrow;</button>
                    </td>
                    <td><img src="${photo.thumbnailLink}" alt=""></td>
                    <td>${photo.title}</td>
                </tr>
            `
        } else {
            const id = checkbox.value
            const selectedRow = document.querySelector(`#selected #photo-${id}`)
            selectedRow.remove()
        }
    }

    function up(button) {
        const row = button.parentElement.parentElement
        const prev = row.previousElementSibling
        if (prev) {
            row.parentElement.insertBefore(row, prev)
        }
    }

    function down(button) {
        const row = button.parentElement.parentElement
        const next = row.nextElementSibling
        if (next) {
            row.parentElement.insertBefore(next, row)
        }
    }

    function copyToCB(button) {
        const rows = document.querySelectorAll('#selected tr')
        const ids = Array.from(rows, row => row.dataset.id)
        const links = ids.map(id => `https://lh3.google.com/u/0/d/${id}`)

        try {
            navigator.clipboard.writeText(links.join('\n'))
            button.innerText = 'Copied'
            button.disabled = true
            setTimeout(() => {
                button.innerText = 'Copy Links'
                button.disabled = false
            }, 1000)
        } catch (e) {
            alert('Copy failed')
        }
    }
</script>
</html>